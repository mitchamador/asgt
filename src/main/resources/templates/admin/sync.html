<!DOCTYPE html>
<html xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      xmlns:th="http://www.thymeleaf.org"
      layout:decorate="~{fragments/layout}">
<head>
    <title></title>
</head>
<body>

<div layout:fragment="content" th:remove="tag">
    <script type="application/javascript">
        $(document).ready($(function () {

            $("#formUploadFile").submit(function (e) {
                var params = {
                    e: e,
                    button: "#buttonUpload",
                    filename: "#fileNameUpload",
                    progressBar: "#progressBar",
                    message: "#alertMsg",
                    type: "syncronizer_data"
                };

                params.pollParams = {
                    // alias для серверной задачи
                    job: "syncronizer",
                    // текстовый компонент для обновления лога
                    text: "#syncLog",
                    // progressBar
                    progressBar: "#progressBar2",
                    // кнопка для закрытия в процессе выполнения
                    button: "#buttonUpload"
                };

                upload(params);
            });

            var pollParams = {
                // alias для серверной задачи
                job: "syncronizer",
                // текстовый компонент для обновления лога
                text: "#syncLog",
                // progressBar
                progressBar: "#progressBar2",
                // кнопка для закрытия в процессе выполнения
                button: "#buttonUpload",
            };
            poll(pollParams);

        }));
    </script>

    <h3>Импорт тарифной политики</h3>

    <form class="row form-group" id="formUploadFile" enctype="multipart/form-data">
        <label>Файл *.csv для синхронизации</label>
<!--
        <div class="row">
-->
            <div class="col-sm-10">
                <input id="fileNameUpload" class="form-control" type="file" name="file">
            </div>
            <button id="buttonUpload" class="col-sm-2 btn btn-primary" type="submit" value="Upload">Загрузить</button>
<!--
        </div>
-->
    </form>

    <div class="row progress">
        <div id="progressBar" class="progress-bar progress-bar-success" role="progressbar"
             aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" style="width: 0%">0%
        </div>
    </div>

<!--
    <div id="alertMsg" class="row" style="text-align: right;color: red;font-size: 12px;"></div>
-->

    <div>
        <div class="row form-group">
            <label for="syncLog">Лог синхронизации ТП</label>
            <textarea id="syncLog" class="form-control" rows="5" style="height: 50vh; font-size: 0.9em; font-family: monospace" readonly></textarea>
        </div>
    </div>
    <div class="row progress">
        <div id="progressBar2" class="progress-bar progress-bar-success" role="progressbar"
             aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" style="width: 0%"></div>
    </div>
    <p class="text-right" th:text="${tpdate}"></p>

    <!--
        <p class="text-left"><a href="javascript:javascript:history.go(-1)" >Вернуться</a></p>
    -->
</div>

<!--
<div layout:fragment="script" th:remove="tag">
    <script type="text/javascript" th:src="@{/js/main.js}"></script>
</div>
-->

</body>

</html>